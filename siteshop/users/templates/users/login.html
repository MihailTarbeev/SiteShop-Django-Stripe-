{% extends "base.html" %}
{% load static %}

{% block "content" %}
<div class="auth-container" style="align-items: flex-start">
    <div class="auth-card">
        <div class="auth-header">
            <h1 class="auth-title">üîê –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É üîê</h1>
            <p class="auth-subtitle">–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å</p> 
        </div>

        <form method="post" class="auth-form" novalidate>
            {% csrf_token %}
            <input type="hidden" name="next" value="{{ request.GET.next }}">
            
            {% if form.non_field_errors %}
            <div class="auth-error">
                {% for error in form.non_field_errors %}
                    {{ error }}
                {% endfor %}
            </div>
            {% endif %}

            {% for field in form %}
            <div class="input-field {% if field.field.widget.input_type == 'checkbox' %}input-field-checkbox{% endif %}">
                
                {% if field.field.widget.input_type == 'checkbox' %}
                    <label class="checkbox-label">
                        {{ field }}
                        <span class="checkbox-text">{{ field.label }}</span>
                    </label>
                {% else %}
                    <label for="{{ field.id_for_label }}" class="field-label">
                        {{ field.label }}
                        {% if field.field.required %}<span class="required">*</span>{% endif %}
                    </label>
                    
                    {% if field.name == 'password' %}
                    <div class="password-field">
                        {{ field }}
                        <button type="button" class="password-toggle" onclick="togglePassword(this)">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path class="icon" 
                                      data-show="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" 
                                      data-hide="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24 M1 1l22 22" 
                                      d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z">
                                </path>
                                <circle class="icon-dot" data-show="12 12 3" data-hide="" cx="12" cy="12" r="3"></circle>
                            </svg>
                        </button>
                    </div>
                    {% else %}
                        {{ field }}
                    {% endif %}
                {% endif %}

                {% if field.help_text and field.name != 'password' %}
                <div class="field-help">
                    {{ field.help_text }}
                </div>
                {% endif %}

                {% if field.errors %}
                <div class="field-error">
                    {% for error in field.errors %}
                        {{ error }}
                    {% endfor %}
                </div>
                {% endif %}
            </div>
            {% endfor %}

            <button type="submit" class="auth-button">
                –í–æ–π—Ç–∏
            </button>

            <div class="auth-links">
                <p>
                    –ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? 
                    <a href="{% url 'users:register' %}" class="link">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a>
                </p>
                <p>
                    {% comment %} <a href="{% url 'password_reset' %}" class="link">–ó–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å?</a> {% endcomment %}
                </p>
            </div>
        </form>
    </div>
</div>

<script>
function togglePassword(button) {
    const input = button.parentElement.querySelector('input');
    const path = button.querySelector('.icon');
    const circle = button.querySelector('.icon-dot');
    
    if (input.type === 'password') {
        input.type = 'text';
        path.setAttribute('d', path.getAttribute('data-hide'));
        circle.setAttribute('cx', '');
        circle.setAttribute('cy', '');
        circle.setAttribute('r', '');
    } else {
        input.type = 'password';
        const dataShow = path.getAttribute('data-show');
        if (dataShow.includes(' M')) {
            path.setAttribute('d', dataShow.split(' M')[0]);
            const coords = dataShow.split(' M')[2].split(' ');
            if (coords.length >= 3) {
                circle.setAttribute('cx', coords[0]);
                circle.setAttribute('cy', coords[1]);
                circle.setAttribute('r', coords[2]);
            }
        } else {
            path.setAttribute('d', dataShow);
        }
    }
}

// –ê–≤—Ç–æ—Ñ–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –ª–æ–≥–∏–Ω–∞
document.addEventListener('DOMContentLoaded', function() {
    const usernameInput = document.querySelector('input[name="username"]');
    if (usernameInput) {
        usernameInput.focus();
    }
});

// –í–∞–ª–∏–¥–∞—Ü–∏—è
document.querySelectorAll('.form-input').forEach(input => {
    input.addEventListener('focus', function() {
        this.parentElement.classList.add('focused');
    });
    
    input.addEventListener('blur', function() {
        if (!this.value) {
            this.parentElement.classList.remove('focused');
        }
        if (this.value && !this.validity.valid) {
            this.classList.add('invalid');
        } else {
            this.classList.remove('invalid');
        }
    });
});
</script>
{% endblock %}