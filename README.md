# üõí –ò–Ω—Ç–µ—Ä–Ω–µ—Ç-–ú–∞–≥–∞–∑–∏–Ω —Å –ü–ª–∞—Ç—ë–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π Stripe

![Django](https://img.shields.io/badge/Django-5.2-092E20?logo=django)
![Python](https://img.shields.io/badge/Python-3.11-3776AB?logo=python)
![Stripe](https://img.shields.io/badge/Stripe-API-008CDD?logo=stripe)
![PostgreSQL](https://img.shields.io/badge/PostgreSQL-17-4169E1?logo=postgresql)
![Docker](https://img.shields.io/badge/Docker-Compose-2496ED?logo=docker)
![DRF](https://img.shields.io/badge/DRF-3.16.1-9C1A1C?logo=django)

## üéØ –û –ø—Ä–æ–µ–∫—Ç–µ

–û—Å–Ω–æ–≤–Ω–æ–π –∑–∞–¥–∞—á–µ–π –ø—Ä–æ–µ–∫—Ç–∞ –±—ã–ª–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω–∞ —Å –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –ø–ª–∞—Ç—ë–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π **Stripe API**. –ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –æ–ø–ª–∞—Ç—ã, —Å–∏—Å—Ç–µ–º—É –Ω–∞–ª–æ–≥–æ–≤ –∏ —Å–∫–∏–¥–æ–∫, –ø–æ–¥–¥–µ—Ä–∂–∫—É –º—É–ª—å—Ç–∏–≤–∞–ª—é—Ç–Ω–æ—Å—Ç–∏ –∏ –¥–≤–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å–ø–æ—Å–æ–±–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π.

**–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- ‚úÖ –î–≤–∞ —Å–ø–æ—Å–æ–±–∞ –æ–ø–ª–∞—Ç—ã: **Stripe Session** –∏ **Stripe Payment Intent**
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –Ω–∞–ª–æ–≥–æ–æ–±–ª–æ–∂–µ–Ω–∏—è —Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π –º–µ–∂–¥—É Django –∏ Stripe
- ‚úÖ –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å–∫–∏–¥–æ–∫ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–∞–Ω–≥–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≤–∞–ª—é—Ç —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–µ–π
- ‚úÖ –ö–æ—Ä–∑–∏–Ω–∞ –ø–æ–∫—É–ø–æ–∫ —Å –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —Ä–∞—Å—á—ë—Ç–æ–º —Å—Ç–æ–∏–º–æ—Å—Ç–∏
- ‚úÖ Django Admin –ø–∞–Ω–µ–ª—å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞–ª–æ–≥–∞–º–∏, —Å–∫–∏–¥–∫–∞–º–∏ –∏ —Ç–æ–≤–∞—Ä–∞–º–∏
- ‚úÖ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è –¥–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è
- ‚úÖ REST API –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è –Ω–∞–ª–æ–≥–æ–≤ –∏ –∫—É–ø–æ–Ω–æ–≤

## üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

- [üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](#–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç)
- [üí≥ –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–ª–∞—Ç—ë–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã STRIPE](#stripe)
  - [Stripe Session](#stripe-session)
  - [Stripe Payment Intent](#stripe-payment-intent)
- [üóÑÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–±–∞–∑—ã-–¥–∞–Ω–Ω—ã—Ö)
- [üí∞ –°–∏—Å—Ç–µ–º–∞ —Å–∫–∏–¥–æ–∫](#—Å–∏—Å—Ç–µ–º–∞-—Å–∫–∏–¥–æ–∫)
- [üèõÔ∏è –°–∏—Å—Ç–µ–º–∞ –Ω–∞–ª–æ–≥–æ–≤](#—Å–∏—Å—Ç–µ–º–∞-–Ω–∞–ª–æ–≥–æ–≤)
- [üîå API Endpoints](#api-endpoints)
- [üìä –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ](#—Ç–µ—Å—Ç–æ–≤—ã–µ-–¥–∞–Ω–Ω—ã–µ)
- [üé® –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Å–∞–π—Ç–∞](#—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª)
- [üë®‚Äçüíª –ê–≤—Ç–æ—Ä](#–∞–≤—Ç–æ—Ä)

<a id="–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç"></a>
## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –î–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º –∑–∞–ø—É—â–µ–Ω–Ω—ã–π **Docker Engine** (–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ **Docker Desktop**)

**1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç**
```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone https://github.com/MihailTarbeev/SiteShop-Django-Stripe-.git
cd SiteShop-Django-Stripe

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
docker compose up --build
```

**2. –ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –æ—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä –ø–æ –∞–¥—Ä–µ—Å—É:**  
`http://127.0.0.1:8000/users/login/`

**3. –¢–µ—Å—Ç–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –¥–ª—è –≤—Ö–æ–¥–∞:**

| –†–æ–ª—å | Username | –ü–∞—Ä–æ–ª—å |
|------|-------|--------|
| üëë –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä | `root` | `123` |
| üë§ –û–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å | `user` | `user123` |

**–î–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏**  
–ü–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ –∞–¥—Ä–µ—Å—É `http://127.0.0.1:8000/users/register/`

**4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Stripe**

**–í–∞–∂–Ω–æ!** –î–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–º —Ñ–∞–π–ª–µ `.env` –¥–æ–ª–∂–Ω—ã –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –∫–ª—é—á–∏:
- `STRIPE_PUBLIC_KEY`
- `STRIPE_API_SECRET_KEY`

–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–ª—é—á–∏ –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –∏–∑ —Å–≤–æ–µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è Stripe:
1. –ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å –Ω–∞ [Stripe Dashboard](https://dashboard.stripe.com/)
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏–∑ —Å–≤–æ–µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è **Publishable key** –∏ **Secret key**
3. –î–æ–±–∞–≤—å—Ç–µ –∏—Ö –≤ —Ñ–∞–π–ª `.env`

<a id="stripe"></a>
## üí≥ –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–ª–∞—Ç—ë–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã STRIPE


<div style="float: right; width: 500px; margin-left: 20px;">
  <img src="./siteshop/media/for_readme/session_pay2.png" width="450" style="display: block; margin-bottom: 20px;">
  <img src="./siteshop/media/for_readme/session_pay.png" width="400" style="display: block; margin-bottom: 20px;;">
  <img src="./siteshop/media/for_readme/PI_pay.png" width="400" style="display: block;">
</div>


–ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—É—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å –ø–ª–∞—Ç—ë–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π Stripe - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º —Ä–µ—à–µ–Ω–∏–µ–º –¥–ª—è –æ–Ω–ª–∞–π–Ω-–ø–ª–∞—Ç–µ–∂–µ–π —Å –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º API –∏ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–º —Ç–µ—Å—Ç–æ–≤—ã–º —Ä–µ–∂–∏–º–æ–º. –° –ø–æ–º–æ—â—å—é Python –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ stripe —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –ø–ª–∞—Ç–µ–∂–µ–π, –æ—Ç –ø—Ä–æ—Å—Ç—ã—Ö –æ–¥–Ω–æ—Ç–æ–≤–∞—Ä–Ω—ã—Ö –ø–æ–∫—É–ø–æ–∫ –¥–æ –º–Ω–æ–≥–æ—Ç–æ–≤–∞—Ä–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤ —Å –Ω–∞–ª–æ–≥–∞–º–∏ –∏ —Å–∫–∏–¥–∫–∞–º–∏.

–í —Ä–∞–º–∫–∞—Ö –ø—Ä–æ–µ–∫—Ç–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –¥–≤–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞, –∫–∞–∂–¥—ã–π –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.


<a id="stripe-session"></a>
### Stripe Session


**Stripe Session** - —ç—Ç–æ –≥–æ—Ç–æ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π. Stripe –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ–ø–ª–∞—Ç—ã, —á—Ç–æ –º–∏–Ω–∏–º–∏–∑–∏—Ä—É–µ—Ç –∫–æ–¥ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞.

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–û–ø–ª–∞—Ç–∏—Ç—å —á–µ—Ä–µ–∑ Stripe Session" –≤ –∫–æ—Ä–∑–∏–Ω–µ
2. –°–µ—Ä–≤–µ—Ä —Å–æ–∑–¥–∞–µ—Ç Stripe Checkout Session
3. –ü—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É Stripe
4. –ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –Ω–∞ —Å–∞–π—Ç

**Endpoint:** `http://127.0.0.1:8000/buy/cart/`



**–ü—Ä–∏–º–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ—Å—Å–∏–∏:**
```python
session = stripe.checkout.Session.create(
    line_items=[{
        'price_data': {
            'currency': 'usd',
            'product_data': {'name': '–¢–æ–≤–∞—Ä'},
            'unit_amount': 2000,
        },
        'quantity': 1,
        'tax_rates': [tax.stripe_tax_id]
    }],
    mode='payment',
    success_url='http://localhost:8000/success/',
    discounts=[{'coupon': 'coupon_id'}] if discount else None
)
```

<a id="stripe-payment-intent"></a>
### Stripe Payment Intent


**Stripe Payment Intent** - —ç—Ç–æ –≥–∏–±–∫–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö —Ñ–æ—Ä–º. –ü–æ–∑–≤–æ–ª—è–µ—Ç –≤—Å—Ç—Ä–∞–∏–≤–∞—Ç—å —Ñ–æ—Ä–º—É –æ–ø–ª–∞—Ç—ã –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å–∞–π—Ç–∞.

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**
- –ù–∞–ª–æ–≥–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ Django 
- –°–∫–∏–¥–∫–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –ø–ª–∞—Ç–µ–∂–∞
- –í—Å–µ –¥–∞–Ω–Ω—ã–µ –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

**Endpoint:** `http://127.0.0.1:8000/buy/payment-intent/`

**–ü—Ä–∏–º–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è Payment Intent:**
```python
payment_intent = stripe.PaymentIntent.create(
            amount=int(total_amount * 100),
            currency=currency.code.lower(),
            metadata={
                "user_id": str(request.user.id),
                "items_count": str(len(cart_items)),
                "base_price": str(base_price_total),
                "tax_amount": str(tax_amount_total),
                "discount": str(discount_amount),
                "rank": rank_name or "none",
            }
        )
```

<a id="—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–±–∞–∑—ã-–¥–∞–Ω–Ω—ã—Ö"></a>
## üóÑÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
–ù–∏–∂–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä–∞—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –ø—Ä–æ–µ–∫—Ç–µ.
<div align="center">
<img src="./siteshop/media/for_readme/db.png" width="800"/>
</div>

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö PostgreSQL —Å–æ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π:

| –ú–æ–¥–µ–ª—å | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|--------|------------|
| **User** | –ö–∞—Å—Ç–æ–º–Ω–∞—è —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| **Tax** | –ù–∞–ª–æ–≥–æ–≤—ã–µ —Å—Ç–∞–≤–∫–∏ |
| **Item** | –¢–æ–≤–∞—Ä—ã –º–∞–≥–∞–∑–∏–Ω–∞ |
| **Category** | –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤ | 
| **Discount** | –ö—É–ø–æ–Ω—ã –Ω–∞ —Å–∫–∏–¥–∫–∏ | 
| **Cart** | –ö–æ—Ä–∑–∏–Ω–∞ –ø–æ–∫—É–ø–æ–∫ |
| **CartItem** | –°–≤—è–∑—å —Ç–æ–≤–∞—Ä–æ–≤ –∏ –∫–æ—Ä–∑–∏–Ω—ã | 
| **Order** | –ó–∞–∫–∞–∑—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π |
| **OrderItem** | –¢–æ–≤–∞—Ä—ã –≤ –∑–∞–∫–∞–∑–∞—Ö | 
| **RankCategory** | –†–∞–Ω–≥–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π |
| **Currency** | –í–∞–ª—é—Ç—ã |

<a id="—Å–∏—Å—Ç–µ–º–∞-—Å–∫–∏–¥–æ–∫"></a>
## üí∞ –°–∏—Å—Ç–µ–º–∞ —Å–∫–∏–¥–æ–∫

<div align="center">
<p><img src="./siteshop/media/for_readme/rangs.png" width="680" style="float: right; margin-bottom: 20px;"/></p>
<p><img src="./siteshop/media/for_readme/rang_profile.png" width="500" style="float: right; margin-left: 20px;"/></p>
</div>

–ù–∞ —Å–∞–π—Ç–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ —Å–∫–∏–¥–æ–∫ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–∞–Ω–≥–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Å–∫–∏–¥–∫—É –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –æ–±—â–µ–π —Å—É–º–º—ã, –≤ —Ä—É–±–ª—è—Ö, –ø–æ—Ç—Ä–∞—á–µ–Ω–Ω–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º.

**üèÜ 11 —É—Ä–æ–≤–Ω–µ–π —Ä–∞–Ω–≥–æ–≤**

**–ú–æ–¥–µ–ª–∏:**
- **Discount** - –∫—É–ø–æ–Ω—ã Stripe —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è
- **RankCategory** - —Ä–∞–Ω–≥–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –ø—Ä–∏–≤—è–∑–∫–æ–π –∫ —Å–∫–∏–¥–∫–∞–º

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- üí± –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤–∞–ª—é—Ç –≤ —Ä—É–±–ª–∏ –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ —Ä–∞–Ω–≥–∞

–î–ª—è —ç—Ç–æ–π —Ü–µ–ª–∏ —É –º–æ–¥–µ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –º–µ—Ç–æ–¥:
```python
# –ú–µ—Ç–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–º–æ–¥–µ–ª–∏ Users)
def get_total_spent(self):
        """–°—É–º–º–∞ –≤—Å–µ—Ö –æ–ø–ª–∞—á–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤ –≤ —Ä—É–±–ª—è—Ö"""
        total_in_rubles = 0
        paid_orders = Order.objects.filter(user=self, status='Paid')

        for order in paid_orders:
            total_in_rubles += Currency.convert_amount_to_rubles(
                order.total_amount,
                order.currency.code
            )

        return round(total_in_rubles, 2)


# –ú–µ—Ç–æ–¥ –º–æ–¥–µ–ª–∏ –≤–∞–ª—é—Ç—ã (Currency)
def convert_amount_to_rubles(cls, amount, currency_code):
    """–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—É–º–º—É –≤ —Ä—É–±–ª–∏."""
    try:
        currency = cls.objects.get(code__iexact=currency_code)
        amount_in_main_unit = float(amount)
        if currency.code.lower() == 'rub':
            return amount_in_main_unit
        return amount_in_main_unit * float(currency.rate_to_rub)
    except cls.DoesNotExist:
        return 0
```

- üìä –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ä–∞–Ω–≥–∞ –≤ –ø—Ä–æ—Ñ–∏–ª–µ
- üé´ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫—É–ø–æ–Ω–∞ –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞
- üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫—É–ø–æ–Ω–æ–≤ –º–µ–∂–¥—É Django –∏ Stripe

**–°–æ–∑–¥–∞–Ω–∏–µ –∫—É–ø–æ–Ω–æ–≤ —á–µ—Ä–µ–∑ Admin –ø–∞–Ω–µ–ª—å:** `http://127.0.0.1:8000/admin/shop/discount/`

**API –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫—É–ø–æ–Ω–æ–≤:** `http://127.0.0.1:8000/api/v1/coupons/`

<a id="—Å–∏—Å—Ç–µ–º–∞-–Ω–∞–ª–æ–≥–æ–≤"></a>
## üèõÔ∏è –°–∏—Å—Ç–µ–º–∞ –Ω–∞–ª–æ–≥–æ–≤

–ü—Ä–æ–µ–∫—Ç –≤–∫–ª—é—á–∞–µ—Ç —Å–∏—Å—Ç–µ–º—É –Ω–∞–ª–æ–≥–æ–æ–±–ª–æ–∂–µ–Ω–∏—è. –ù–∞–ª–æ–≥–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω—ã –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞.

**üìã –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã –Ω–∞–ª–æ–≥–æ–≤**
- –†–∞–∑–Ω—ã–µ —Ç–∏–ø—ã –Ω–∞–ª–æ–≥–æ–≤: –ù–î–°, –∞–∫—Ü–∏–∑—ã, —ç–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ —Å–±–æ—Ä—ã
- –ì–∏–±–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏: –ø—Ä–æ—Ü–µ–Ω—Ç–Ω–∞—è —Å—Ç–∞–≤–∫–∞, –≤–∫–ª—é—á–µ–Ω–∏–µ –≤ —Ü–µ–Ω—É, –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
- –ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è –ø—Ä–∏–≤—è–∑–∫–∞: —Å—Ç—Ä–∞–Ω–∞, —Ä–µ–≥–∏–æ–Ω, —é—Ä–∏—Å–¥–∏–∫—Ü–∏—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å Stripe Tax Rates

<div align="center">
<img src="./siteshop/media/for_readme/taxs.png" width="1000" style=""/>
</div>

**–°–≤—è–∑—å —Å —Ç–æ–≤–∞—Ä–∞–º–∏:**
```python
class Item(models.Model):
    # ...
    taxes = models.ManyToManyField(Tax, blank=True)  # –ù–∞–ª–æ–≥–∏ —Ç–æ–≤–∞—Ä–∞
```

**–°–æ–∑–¥–∞–Ω–∏–µ –Ω–∞–ª–æ–≥–æ–≤ —á–µ—Ä–µ–∑ Admin –ø–∞–Ω–µ–ª—å:** `http://127.0.0.1:8000/admin/shop/tax/`

**API –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞–ª–æ–≥–æ–≤:** `http://127.0.0.1:8000/api/v1/tax-rates/`


<a id="api-endpoints"></a>
## üîå API Endpoints

### üì± –û—Å–Ω–æ–≤–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã

| –ú–µ—Ç–æ–¥ | URL | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-------|-----|------------|
| GET | `http://127.0.0.1:8000/` | –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–æ –≤—Å–µ–º–∏ —Ç–æ–≤–∞—Ä–∞–º–∏ |
| GET | `http://127.0.0.1:8000/category/<slug>/` | –¢–æ–≤–∞—Ä—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ |
| GET | `http://127.0.0.1:8000/item/<slug>/` | –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–≤–∞—Ä–µ |
| GET/POST | `http://127.0.0.1:8000/item/<slug>/edit/` | –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ (—Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª—å—Ü—É —Ç–æ–≤–∞—Ä–∞) |
| GET/POST | `http://127.0.0.1:8000/add_item/` | –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–æ–≤–∞—Ä–∞ (–ª—é–±–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é) |
| GET/POST | `http://127.0.0.1:8000/delete_item/<slug>/` | –£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ (—Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª—å—Ü—É —Ç–æ–≤–∞—Ä–∞) |
| GET/POST | `http://127.0.0.1:8000/users/register/` | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| GET/POST | `http://127.0.0.1:8000/users/login/` | –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è |
| GET | `http://127.0.0.1:8000/users/logout/` | –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã |
| GET | `http://127.0.0.1:8000/users/profile/` | –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |

### üõí –ö–æ—Ä–∑–∏–Ω–∞ –∏ –æ–ø–ª–∞—Ç–∞

| –ú–µ—Ç–æ–¥ | URL | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-------|-----|------------|
| GET | `http://127.0.0.1:8000/cart/` | –ü—Ä–æ—Å–º–æ—Ç—Ä –∫–æ—Ä–∑–∏–Ω—ã |
| POST | `http://127.0.0.1:8000/cart/clear/` | –û—á–∏—Å—Ç–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã |
| POST | `http://127.0.0.1:8000/buy/cart/` | –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ —á–µ—Ä–µ–∑ Stripe Session |
| POST | `http://127.0.0.1:8000/buy/payment-intent/` | –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Stripe Payment Intent |
| POST | `http://127.0.0.1:8000/item/<slug>/add-to-cart/` | –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –≤ –∫–æ—Ä–∑–∏–Ω—É |
| POST | `http://127.0.0.1:8000/item/<slug>/remove-from-cart/` | –£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã |
| POST | `http://127.0.0.1:8000/item/<slug>/update-cart/` | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–æ–≤–∞—Ä–∞ |

### üí≥ –ü–ª–∞—Ç–µ–∂–∏ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

| –ú–µ—Ç–æ–¥ | URL | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-------|-----|------------|
| GET | `http://127.0.0.1:8000/buy/item/<item_slug>/` | –ü–æ–∫—É–ø–∫–∞ –æ–¥–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä–∞ —á–µ—Ä–µ–∑ Stripe Session |
| GET | `http://127.0.0.1:8000/create_session_success/` | –°—Ç—Ä–∞–Ω–∏—Ü–∞ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã (Session) |
| GET | `http://127.0.0.1:8000/payment-intent/success/` | –°—Ç—Ä–∞–Ω–∏—Ü–∞ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã (Payment Intent) |

### üîß API –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

| –ú–µ—Ç–æ–¥ | URL | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-------|-----|------------|
| GET | `http://127.0.0.1:8000/api/v1/tax-rates/` | –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –Ω–∞–ª–æ–≥–æ–≤ Stripe |
| GET | `http://127.0.0.1:8000/api/v1/coupons/` | –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –∫—É–ø–æ–Ω–æ–≤ Stripe |

### üõ†Ô∏è –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ

| –ú–µ—Ç–æ–¥ | URL | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-------|-----|------------|
| GET | `http://127.0.0.1:8000/admin/` | Django Admin –ø–∞–Ω–µ–ª—å |
| GET | `http://localhost:8080/` | Adminer (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ë–î) |

<a id="—Ç–µ—Å—Ç–æ–≤—ã–µ-–¥–∞–Ω–Ω—ã–µ"></a>
## üìä –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–æ–µ–∫—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–∞–π–ª–∞ `db.json`, –≤–∫–ª—é—á–∞—é—â–∏–µ:

- üì¶ –¢–µ—Å—Ç–æ–≤—ã–µ —Ç–æ–≤–∞—Ä–æ–≤
- üè∑Ô∏è –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤
- üë• –¢–µ—Å—Ç–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- üí∞ –í–∞–ª—é—Ç—ã
- üèõÔ∏è –ö–∞—Å—Ç–æ–º–Ω—ã–µ –Ω–∞–ª–æ–≥–∏
- üé´ –ö—É–ø–æ–Ω—ã –Ω–∞ —Å–∫–∏–¥–∫–∏
- üìä –†–∞–Ω–≥–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–ß—Ç–æ–±—ã –æ—Ç–∫–ª—é—á–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö,** –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é —Å—Ç—Ä–æ–∫—É –≤ `compose.yml`:
```yaml
command: >
  sh -c "python manage.py migrate &&
        # { python manage.py loaddata /app/www/siteshop/db.json 2>/dev/null || echo 'No fixtures found'; } &&
        python manage.py runserver 0.0.0.0:8000"
```

<a id="—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª"></a>
## üé® –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Å–∞–π—Ç–∞

### üì± –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

<table>
  <tr>
    <td align="center" valign="top">
      <img src="./siteshop/media/for_readme/common.png" width="95%">
      <br>
      <b>üè† –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –º–∞–≥–∞–∑–∏–Ω–∞</b>
    </td>
    <td align="center" valign="top">
      <img src="./siteshop/media/for_readme/profile.png" width="90%">
      <br>
      <b>üë§ –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º —Ä–∞–Ω–≥–∞</b>
    </td>
  </tr>
  <tr>
    <td align="center" valign="top">
      <img src="./siteshop/media/for_readme/item.png" width="90%">
      <br>
      <b>üõçÔ∏è –ö–∞—Ä—Ç–æ—á–∫–∞ —Ç–æ–≤–∞—Ä–∞ —Å –∫–Ω–æ–ø–∫–æ–π –ø–æ–∫—É–ø–∫–∏</b>
    </td>
    <td align="center" valign="top">
      <img src="./siteshop/media/for_readme/cart.png" width="100%">
      <br>
      <b>üõí –ö–æ—Ä–∑–∏–Ω–∞ —Å –≤—ã–±–æ—Ä–æ–º —Å–ø–æ—Å–æ–±–∞ –æ–ø–ª–∞—Ç—ã</b>
    </td>
  </tr>
  <tr>
    <td align="center" valign="top">
      <img src="./siteshop/media/for_readme/login.png" width="100%">
      <br>
      <b>üîë –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ —Å–∏—Å—Ç–µ–º–µ</b>
    </td>
    <td align="center" valign="top">
      <img src="./siteshop/media/for_readme/registration.png" width="100%">
      <br>
      <b>üìù –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</b>
    </td>
  </tr>
</table>


<a id="–∞–≤—Ç–æ—Ä"></a>
## üë®‚Äçüíª –ê–≤—Ç–æ—Ä

**–ú–∏—Ö–∞–∏–ª –¢–∞—Ä–±–µ–µ–≤**  
Python Developer

[![GitHub](https://img.shields.io/badge/GitHub-MihailTarbeev-181717?logo=github)](https://github.com/MihailTarbeev)  



‚≠ê **–°–ø–∞—Å–∏–±–æ –í–∞–º –∑–∞ –∏–Ω—Ç–µ—Ä–µ—Å –∫ –º–æ–∏–º –ø—Ä–æ–µ–∫—Ç–∞–º** ‚≠ê